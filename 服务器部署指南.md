# æœåŠ¡å™¨éƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“¦ é¡¹ç›®ç»„æˆè¯´æ˜

### Nginxæ¥æºè§£é‡Š
**nginxä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå•ç‹¬å®‰è£…ï¼** å®ƒæ¥è‡ªäºDockeré•œåƒï¼š

1. **å‰ç«¯Dockerfileä¸­çš„é…ç½®ï¼š**
   ```dockerfile
   # ç”Ÿäº§é˜¶æ®µ
   FROM nginx:alpine  # â† nginxæ¥æºï¼šå®˜æ–¹Dockeré•œåƒ
   ```

2. **å·¥ä½œåŸç†ï¼š**
   - Dockeræ„å»ºæ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ `nginx:alpine` é•œåƒ
   - è¯¥é•œåƒå·²ç»åŒ…å«å®Œæ•´çš„nginx webæœåŠ¡å™¨
   - æˆ‘ä»¬åªéœ€è¦æä¾›é…ç½®æ–‡ä»¶ `nginx.conf`

### é¡¹ç›®æ¶æ„
```
é¡¹ç›®éƒ¨ç½²æ¶æ„ï¼š
â”œâ”€â”€ å‰ç«¯å®¹å™¨ (nginx:alpine)
â”‚   â”œâ”€â”€ Vue.jsæ„å»ºäº§ç‰© (/usr/share/nginx/html)
â”‚   â”œâ”€â”€ nginx.conf (é…ç½®æ–‡ä»¶)
â”‚   â””â”€â”€ ç«¯å£æ˜ å°„: ä¸»æœº80 â†’ å®¹å™¨80
â”œâ”€â”€ åç«¯å®¹å™¨ (python:3.11-slim)
â”‚   â”œâ”€â”€ FastAPIåº”ç”¨
â”‚   â””â”€â”€ ç«¯å£æ˜ å°„: ä¸»æœº8000 â†’ å®¹å™¨8000
â””â”€â”€ Dockerç½‘ç»œ (å®¹å™¨é—´é€šä¿¡)
```

## ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒ

#### 1.1 å®‰è£…Docker
```bash
# CentOS/RHEL
sudo yum install -y docker docker-compose

# Ubuntu/Debian
sudo apt update
sudo apt install -y docker.io docker-compose

# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

#### 1.2 é…ç½®Dockeræƒé™ï¼ˆå¯é€‰ï¼‰
```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„ï¼Œé¿å…æ¯æ¬¡ä½¿ç”¨sudo
sudo usermod -aG docker $USER
# é‡æ–°ç™»å½•ç”Ÿæ•ˆ
```

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨

#### æ–¹æ³•1ï¼šä½¿ç”¨Gitï¼ˆæ¨èï¼‰
```bash
# åœ¨æœåŠ¡å™¨ä¸Šå…‹éš†é¡¹ç›®
git clone <ä½ çš„é¡¹ç›®ä»“åº“åœ°å€>
cd email
```

#### æ–¹æ³•2ï¼šä½¿ç”¨SCPä¸Šä¼ 
```bash
# åœ¨æœ¬åœ°ç”µè„‘ä¸Šæ‰§è¡Œï¼Œå°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ä¸Šä¼ 
scp -r /path/to/email username@server_ip:/home/username/
```

#### æ–¹æ³•3ï¼šä½¿ç”¨FTPå·¥å…·
- ä½¿ç”¨FileZillaã€WinSCPç­‰å·¥å…·
- å°†æ•´ä¸ª `email` æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨

### ç¬¬ä¸‰æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²

#### 3.1 è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /path/to/email  # è¿›å…¥ä¸Šä¼ çš„é¡¹ç›®ç›®å½•
```

#### 3.2 æ£€æŸ¥é¡¹ç›®ç»“æ„
```bash
ls -la
# åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š
# - docker-compose.yml
# - email/ (å‰ç«¯æ–‡ä»¶å¤¹)
# - email-api/ (åç«¯æ–‡ä»¶å¤¹)
# - deploy.sh
# - å…¶ä»–é…ç½®æ–‡ä»¶
```

#### 3.3 å¯åŠ¨æœåŠ¡
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨docker-composeç›´æ¥å¯åŠ¨
docker-compose up -d

# æ–¹æ³•2ï¼šä½¿ç”¨éƒ¨ç½²è„šæœ¬
chmod +x deploy.sh
./deploy.sh
```

#### 3.4 éªŒè¯éƒ¨ç½²
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tulnp | grep -E ":(80|8000)"
```

### ç¬¬å››æ­¥ï¼šé…ç½®æœåŠ¡å™¨è®¿é—®

#### 4.1 å¼€æ”¾é˜²ç«å¢™ç«¯å£
```bash
# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload

# Ubuntu (ufw)
sudo ufw allow 80
sudo ufw allow 8000

# æˆ–è€…åªå¼€æ”¾80ç«¯å£ï¼ˆæ¨èï¼‰
sudo ufw allow 80
```

#### 4.2 è·å–æœåŠ¡å™¨IP
```bash
# æŸ¥çœ‹æœåŠ¡å™¨å…¬ç½‘IP
curl ifconfig.me
# æˆ–
ip addr show
```

## ğŸŒ è®¿é—®é¡¹ç›®

### éƒ¨ç½²æˆåŠŸåè®¿é—®åœ°å€ï¼š
- **å‰ç«¯åº”ç”¨**: `http://æœåŠ¡å™¨IP`
- **åç«¯API**: `http://æœåŠ¡å™¨IP:8000/api/mail`

### ç¤ºä¾‹ï¼š
å¦‚æœæœåŠ¡å™¨IPæ˜¯ `123.456.789.0`ï¼š
- å‰ç«¯ï¼š`http://123.456.789.0`
- åç«¯ï¼š`http://123.456.789.0:8000`

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### 1. ç«¯å£è¢«å ç”¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulnp | grep :80

# è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
# ä¾‹å¦‚ï¼šå°† "80:80" æ”¹ä¸º "8080:80"
```

### 2. Dockeræƒé™é—®é¢˜
```bash
# å¦‚æœå‡ºç°æƒé™é”™è¯¯ï¼Œä½¿ç”¨sudo
sudo docker-compose up -d
```

### 3. æ— æ³•è®¿é—®
æ£€æŸ¥é¡ºåºï¼š
1. å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`docker-compose ps`
2. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£
3. äº‘æœåŠ¡å™¨å®‰å…¨ç»„æ˜¯å¦é…ç½®
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### 4. APIæ— æ³•è¿æ¥
- æ£€æŸ¥åç«¯å®¹å™¨æ—¥å¿—ï¼š`docker-compose logs backend`
- ç¡®è®¤DeepSeek APIå¯†é’¥æœ‰æ•ˆ
- æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œèƒ½å¦è®¿é—®å¤–éƒ¨API

## ğŸ“ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### 1. ä½¿ç”¨åŸŸå
```bash
# è´­ä¹°åŸŸåå¹¶è§£æåˆ°æœåŠ¡å™¨IP
# ä¿®æ”¹nginx.confä¸­çš„server_name
```

### 2. é…ç½®SSLè¯ä¹¦
```bash
# ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦
sudo apt install certbot
sudo certbot --nginx -d yourdomain.com
```

### 3. è®¾ç½®è‡ªåŠ¨é‡å¯
```bash
# æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨å¯åŠ¨å®¹å™¨
# docker-compose.ymlä¸­å·²é…ç½® restart: unless-stopped
```

### 4. æ•°æ®å¤‡ä»½
```bash
# å®šæœŸå¤‡ä»½é¡¹ç›®é…ç½®å’Œæ•°æ®
tar -czf email-backup-$(date +%Y%m%d).tar.gz /path/to/email
```

## ğŸ¯ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤æ€»ç»“

```bash
# 1. ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨å
cd /path/to/email

# 2. ä¸€é”®éƒ¨ç½²
chmod +x deploy.sh && ./deploy.sh

# 3. æ£€æŸ¥çŠ¶æ€
docker-compose ps

# 4. è®¿é—®åº”ç”¨
echo "è®¿é—® http://$(curl -s ifconfig.me)"
``` 